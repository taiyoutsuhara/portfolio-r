# R言語による技術の棚卸し #
成果物（2020/1/12時点）は以下のとおりです。各々の詳細は、該当のMarkdownを参照してください。

文体を次のように統一しています。
* 敬体：本ドキュメント
* 常体：各成果物のMarkdown

### 実行手順
実行環境にRとRStudioがインストールされていることを前提とします。

RStudioでリポジトリのクローン先となるProjectを作成します。プロジェクト名とリポジトリ名とを揃えておくと便利です。Projectを作成すると、Rprojファイルがあるディレクトリをワーキングディレクトリとして認識します。

クローン先を用意した後、以下の手順を実行します。
* Gitを使用の場合：作成したクローン先プロジェクトフォルダを、一度他のディレクトリに移動してから、クローン先のディレクトリにおいて`git clone`コマンドを実行します。Sourcetree等のGUIクライアントでも同機能があります。実行後、移動済クローン先プロジェクトフォルダに残っているものを、`git clone`したリポジトリの直下に移動します。なお、`.gitignore`は`git clone`したものを正とします。
* そうでない場合：`Clone or download`の`Download ZIP`をクリックし、クローン先のディレクトリに展開します。  

Rのライブラリで足りないものは、あらかじめインストールするように実装していますが、RStanはアップデートを要することがありますので省いています。なお、エラー等により一括インストールできないときは、個々にインストールしてください。

### 1.propensity_score_analysis
サービス比較システムであり、本システムの特色は次の2点です。
1. 一般化傾向スコア分析によるサービス導入効果の予測
1. Shiny Dashboardによるサービス比較の容易化

詳細は下記Markdownにまとめています。  
https://github.com/taiyoutsuhara/portfolio-r/blob/master/1.propensity_score_analysis/readme_ja.md

設計と実装にあたって、次の事項を想定しています。

##### シーズ
1. 効果を正しく推定するため共変量調整※が必要であるが、共変量数と組合せの数は指数関係にあること  
※介入群（例：サービス利用者）と対照群（例：非利用者）とで共通に得られる変数を両群で不偏にすること
1. レポーティングにおいて、ExcelといったOSに依存しがちなOfficeスイートに拠ると、シームレス化や大規模データ処理が難しいこと

##### ニーズ
1. 早急に予想を知り戦略のアウトラインを大まかに書くこと
1. 2種類以上のサービスの優先順位が付けがたく、慎重を期したいこと
1. ターゲット（年代、居住地方、職業等の属性）別にメリット最大化できそうなサービスの目星
1. 複数属性（例えば若年×東日本×学生）に有効なサービスの予想

### 2.rstan_psa
`1.propensity_score_analysis`の一般化傾向スコア、逆確率重みづけ推定量、ならびにサービス導入効果（縮退時）を、Stanによって推定します。Stanとはベイズ推定によってパラメータを推定するフリーソフトです。

詳細は下記Markdownにまとめています。  
https://github.com/taiyoutsuhara/portfolio-r/blob/master/2.rstan_psa/readme_stan.md

##### 注意事項
Stan実行時に並列演算をさせていますが、並列化しない場合、RStanを最新版にアップデートしてください。
```
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
```
RStanのアップデート方法は、以下のURLを参照してください。  
https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started-(Japanese)

Stanによる一般化傾向スコアの推定に、時間が非常にかかります※。また、収束しないことが往々にしてあります。  
※PCのスペックに依存しますが、おおよその目安は**最短半日**です。